# SpringLab

# Регистрация
Доступна регистрация только пользователей (роль USER (id 1 в базе - user, 2 - admin)) \
Для логина под администратором:
- username: admin
- password: admin123 

Для логина под первичным пользователем:
- username: user
- password: user123 

# Запуск
1. Выполнить docker build -t lab . 
2. Выполнить docker-compose up
3. Открыть http://localhost:8080/swagger-ui/index.html
4. Следовать руководству пользователя 

# Начальные данные
Предусмотрено наличие шести стандартных задач
- id 1, 2, 5 - user
- id 3, 4, 6 - admin

# Руководство пользователя:
0. Отркыть Swagger - http://localhost:8080/swagger-ui/index.html
1. Получить JWT-токен через /api/auth/login для первичного пользователя или администратора
1.1 (Опционально) Зарегистрировать нового пользователя (обязательно ввести валидный email, пример - newuser@email.com)
2. Вставить токен в Swagger через кнопку "Authorize" (вверху справа) 
3. Ипользовать post /api/groups для создания группы задач
4. Получить id созданно задачи через get /api/groups
5. Через post /api/tasks создать задачу, использовать id группы задач (опционально)
6. Аналогично пользоваться остальными endpoints (краткое описание доступно в Swagger, а также ниже в этом файле)

# Описание endpoints:
1. Регистрация нового пользователя (не администратора)\
POST /api/auth/register
```json
{
  "username": "string (3-50 символов)",
  "email": "string (валидный email)",
  "password": "string (минимум 6 символов)"
}
```
2. Получение JWT-токена\
POST /api/auth/login
```json
{
  "username": "admin",
  "password": "admin123"
}
```
Ответ:
```json
{
  "token": "JWT токен",
  "type": "Bearer",
  "id": 1,
  "username": "имя пользователя",
  "email": "email пользователя",
  "roles": ["ROLE_USER", "ROLE_ADMIN"]
}
```
3. Создание новой задачи\
POST /api/tasks (требуется аутентификация)
```json
{
  "title": "Название задачи",
  "description": "Описание задачи",
  "status": "PENDING | IN_PROGRESS | COMPLETED",
  "groupId": 1  // опционально, ID группы
}\
```
4. Просмотр всех задач (для пользователя - только его задачи, для администратора - все задачи)\
GET /api/tasks (требуется аутентификация)

5. Получить задачи без групп \
GET /api/tasks/without-group (требуется аутентификация)

6. Получить задачу по ID (для пользователя - только его задачи, для администратора - все задачи)\
GET /api/tasks/{id} (требуется аутентификация)

7. Обновить задачу\
PUT /api/tasks/{id} (требуется аутентификация)
```json
{
  "title": "Обновленное название",
  "description": "Обновленное описание",
  "status": "COMPLETED",
  "groupId": 2  // сменить группу или null чтобы убрать из группы
}
```
8. Удалить задачу\
DELETE /api/tasks/{id} (требуется аутентификация)

9. Добавить задачу в группу (только свои задачи и группы)\
PUT /api/tasks/{taskId}/group/{groupId} (требуется аутентификация)

10. Удалить задачу из группы\
DELETE /api/tasks/{taskId}/group (требуется аутентификация)

11. Создать новую группу\
POST /api/groups (требуется аутентификация)
```json
{
  "name": "Название группы",
  "description": "Описание группы"
}
```
12. Получить все группы (для пользователя - только его задачи, для администратора - все задачи)\
GET /api/groups (требуется аутентификация)

13. Получить группу по ID (для пользователя - только его задачи, для администратора - все задачи)\
GET /api/groups/{id} (требуется аутентификация)

14. Получить группу с задачами\
GET /api/groups/{id}/with-tasks (требуется аутентификация)

15. Получить задачи группы\
GET /api/groups/{id}/tasks (требуется аутентификация)

16. Обновить группу\
PUT /api/groups/{id} (требуется аутентификация)

17. Удалить группу, включая вложенные задачи\
DELETE /api/groups/{id} (требуется аутентификация)

18. Добавить задачу в группу\
POST /api/groups/{groupId}/tasks/{taskId} (требуется аутентификация)

19. Удалить задачу из группы\
DELETE /api/groups/{groupId}/tasks/{taskId} (требуется аутентификация)

20. Общая статистика\
GET /api/statistics (требуется аутентификация)

21. Статистика по группам\
GET /api/statistics/groups (требуется аутентификация)

22. Статистика по пользователям (только ADMIN)\
GET /api/statistics/users (требуется аутентификация)

# Роли пользователей
Роль USER (Обычный пользователь):
- Может создавать/редактировать/удалять свои задачи
- Может создавать/редактировать/удалять свои группы
- Видит только свои задачи и группы
- Получает статистику только по своим данным
- Не видит статистику других пользователей
- Не имеет доступа к административным endpoints

Роль ADMIN (Администратор):
- Все права USER
- Может редактировать/удалять любые задачи
- Может редактировать/удалять любые группы
- Видит все задачи и группы в системе
- Получает полную статистику по системе
- Имеет доступ к административным endpoints статистики
- Может просматривать статистику по всем пользователям

# База данных 
- PostgreSQL
- port=5432
- username=taskuser
- password=taskpassword
- db_name=task_manager_db

